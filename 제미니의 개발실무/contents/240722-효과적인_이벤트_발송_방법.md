# 효과적인 이벤트 발송 방법 (feat. Transactional Outbox, Polling, Async)

> [유튜브](https://www.youtube.com/watch?v=ZbA5jCHZ6H8&t=2s)

질문자 트랜잭셔널 아웃박스 패턴을 만들고 배치를 통해 폴링으로 이벤트 소비 중

폴링으로 구현하면 디비 커넥션이 열려있고, 배치 스케줄러가 작동할 때 락이 걸리다보니 성능이 안좋아 질 것으로 예상하는데

대규모 트래픽이 발생하는 회사나 도메인이 아니면 괜찮지 않을까?

> 괜찮을 수 있음 -> 현재 트래픽에서 몇 2~3 배 정도 부하를 통해서 큰 문제 없는지 확인

로그 테일링 기법으로 해결하는 것?

> 어플리케이션 레벨에서 해결하는 것을 선호

문제가 발생될 때까지 간단한 구현으로 유지 후 문제가 발생되면 넘어갈지?

> 문제를 먼저 예상하는 것이 좋긴 함

로그 테일링은 오픈소스도 껴서 해야하고, 자잘한 복잡성이 추가됨

폴링 방식 재검토

- 과정을 봤을 때 커넥션이 그렇게 계속 열려있지는 않음  
  - 데이터 읽고 -> 커넥션 필요
  - 분산 처리로 뿌리고 -> 필요 없음
  - 결과를 업데이트하고 -> 필요

작은 규모라면...

API 요청 받은 스레드 -> DB 에 이벤트 저장 >> 트랜잭션 끝

@Async 스레드로 이벤트를 쏜 다음에 성공하면 db 상태 업데이트

문제가 있으면 재시도 하는 배치만 둠 -> 실패 했을 때만 폴링 배치에서 재시도
